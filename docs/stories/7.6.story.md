# Story 7.6: ClaudeCode 配置页面

**Epic**: Epic 7 - Web 管理界面
**Story ID**: 7.6
**Story Title**: ClaudeCode 配置页面
**Status**: 待开始 ⏳
**估算工时**: 1 天 (8 小时)
**优先级**: P2 (COULD HAVE)
**创建日期**: 2025-10-02

---

## Story Statement

**作为** Claude Code CLI 用户
**我想要** 通过 Web 界面生成 Claude Code 配置文件
**以便于** 快速配置 Claude Code 连接到 Siriusx-API，无需手动编写配置

---

## 需求背景 (Epic 7)

根据 PRD Epic 7 的规划，ClaudeCode 配置页面需要提供一键生成配置文件的功能，帮助用户快速完成 Claude Code CLI 的配置。

---

## 任务清单

### AC1: 创建配置生成页面
- [ ] 创建 `src/pages/claude-config.astro`
- [ ] 创建 `src/components/ClaudeCodeConfig.tsx`
- [ ] 实现页面路由和导航

### AC2: 配置信息展示
- [ ] 显示 API Base URL (从配置或环境变量获取)
- [ ] 显示可用模型列表 (调用 `GET /api/models`)
- [ ] 显示配置说明和使用指南
- [ ] 实现信息卡片布局

### AC3: Token 选择器
- [ ] 实现 Token 下拉选择器
- [ ] 从 `GET /api/tokens` 获取 Token 列表
- [ ] 显示 Token 名称和脱敏 Token
- [ ] 支持搜索/过滤 Token

### AC4: 配置文件生成
- [ ] 实现生成配置按钮
- [ ] 根据选择的 Token 生成配置 JSON
- [ ] 配置格式符合 Claude Code 规范
- [ ] 包含所有可用模型
- [ ] 配置 API Base URL

### AC5: 配置内容展示
- [ ] 实现 JSON 代码块展示
- [ ] 实现语法高亮 (使用 highlight.js 或类似库)
- [ ] 支持代码折叠/展开
- [ ] 格式化 JSON (美化输出)

### AC6: 复制功能
- [ ] 实现复制配置到剪贴板按钮
- [ ] 使用 Clipboard API
- [ ] 复制成功显示 Toast 提示
- [ ] 复制失败显示错误提示

### AC7: 手动配置步骤说明
- [ ] 编写清晰的配置步骤说明
- [ ] 使用有序列表展示步骤
- [ ] 包含命令行示例
- [ ] 包含配置文件路径说明
- [ ] 提供故障排查提示

### AC8: 交互优化
- [ ] 选择不同 Token 时配置自动更新
- [ ] 所有操作显示 Loading 状态
- [ ] 操作成功/失败显示 Toast 提示
- [ ] 响应式布局

---

## 验收标准

### 1. 配置生成功能
- [ ] 可以选择 Token
- [ ] 生成的配置 JSON 格式正确
- [ ] 配置符合 Claude Code 规范
- [ ] 包含所有必要字段

### 2. JSON 展示
- [ ] JSON 语法高亮正确
- [ ] 格式化输出美观
- [ ] 可读性良好
- [ ] 支持代码折叠 (可选)

### 3. 复制功能
- [ ] 复制配置功能正常
- [ ] 复制成功显示提示
- [ ] 复制的内容可直接使用
- [ ] 复制失败有错误处理

### 4. 配置步骤说明
- [ ] 步骤说明清晰易懂
- [ ] 命令示例准确
- [ ] 路径说明正确
- [ ] 提供常见问题解答

### 5. 自动更新
- [ ] 选择不同 Token 时配置自动更新
- [ ] API Base URL 自动填充
- [ ] 模型列表自动加载
- [ ] 更新响应迅速

### 6. 用户体验
- [ ] 页面加载 < 1 秒
- [ ] 交互响应流畅
- [ ] Toast 提示清晰
- [ ] 响应式布局良好

---

## 技术细节

### 组件结构
```
ClaudeCodeConfig.tsx
├── ConfigInfo           # 配置信息展示
│   ├── ApiBaseUrl
│   └── AvailableModels
├── TokenSelector        # Token 选择器
├── ConfigGenerator      # 配置生成器
├── ConfigDisplay        # 配置展示
│   ├── SyntaxHighlight
│   └── CopyButton
└── SetupGuide          # 配置步骤说明
```

### API 调用
```typescript
// 获取可用模型
GET /api/models
Response: [{
  id: number,
  name: string,
  description: string
}]

// 获取 Token 列表
GET /api/tokens
Response: [{
  id: number,
  name: string,
  token: string  // 脱敏
}]
```

### 生成的配置格式
```json
{
  "providers": [
    {
      "id": "siriusx",
      "name": "Siriusx-API",
      "baseURL": "http://localhost:8080/v1",
      "apiKey": "tk-xxxxxxxxxxxxx",
      "models": [
        {
          "id": "claude-sonnet-4",
          "name": "Claude Sonnet 4"
        },
        {
          "id": "claude-opus-4",
          "name": "Claude Opus 4"
        }
      ]
    }
  ],
  "defaultProvider": "siriusx",
  "defaultModel": "claude-sonnet-4"
}
```

### 配置文件路径
- **macOS/Linux**: `~/.config/claude-code/config.json`
- **Windows**: `%APPDATA%\claude-code\config.json`

---

## 配置步骤说明内容

### 步骤 1: 生成配置文件
1. 在上方选择一个 Token
2. 点击"生成配置"按钮
3. 复制生成的 JSON 配置

### 步骤 2: 创建配置目录
```bash
# macOS/Linux
mkdir -p ~/.config/claude-code

# Windows (PowerShell)
New-Item -ItemType Directory -Path "$env:APPDATA\claude-code" -Force
```

### 步骤 3: 保存配置文件
```bash
# macOS/Linux
nano ~/.config/claude-code/config.json
# 粘贴配置内容，保存并退出

# Windows
notepad %APPDATA%\claude-code\config.json
# 粘贴配置内容，保存并退出
```

### 步骤 4: 测试连接
```bash
claude-code --version
claude-code models list
```

### 故障排查
- **连接失败**: 检查 API Base URL 是否正确
- **认证失败**: 检查 Token 是否有效
- **模型不可用**: 检查模型名称是否匹配

---

## 实现状态

⏳ **待开始** - 此功能尚未实现

### 待实现的功能
1. ⏳ 创建 ClaudeCode 配置页面
2. ⏳ Token 选择器
3. ⏳ 配置 JSON 生成逻辑
4. ⏳ 语法高亮展示
5. ⏳ 复制到剪贴板功能
6. ⏳ 配置步骤说明
7. ⏳ 响应式布局

### 依赖项
- Story 7.1 (Astro 项目) ✅
- Story 6.1 (Token 管理) ✅
- Story 4.1 (模型管理) ✅

---

## 界面设计

### 页面布局
```
┌─────────────────────────────────────────┐
│  Claude Code Configuration              │
├─────────────────────────────────────────┤
│  📋 Configuration Info                  │
│  API Base URL: http://localhost:8080/v1│
│  Available Models: 3                    │
│                                         │
│  🔑 Select Token                        │
│  Token: [dev-token ▼]                   │
│                                         │
│  [Generate Configuration]               │
│                                         │
│  📄 Generated Configuration             │
│  ┌─────────────────────────────────┐   │
│  │ {                               │ 📋│
│  │   "providers": [...]            │   │
│  │ }                               │   │
│  └─────────────────────────────────┘   │
│                                         │
│  📖 Setup Guide                         │
│  1. Copy the configuration above       │
│  2. Create config directory            │
│  3. Save to config file                │
│  4. Test the connection                │
└─────────────────────────────────────────┘
```

---

## 相关文档

- [PRD - Epic 7: Web 管理界面](../prd.md#epic-7-web-管理界面-fr20-fr24-fr6)
- [Story 7.1 - 搭建 Astro + React 项目](./7.1.story.md)
- [Story 6.1 - Token 生成和存储](./6.1.story.md)
- [Story 4.1 - 统一模型管理](./4.1.story.md)
- [Claude Code 官方文档](https://docs.claude.com/claude-code)

---

## 备注

此功能为 P2 优先级 (COULD HAVE)，可以在核心功能完成后再实现。如果时间紧张，可以提供手动配置文档作为替代方案。
