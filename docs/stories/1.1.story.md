# Story 1.1: 创建 Go 项目骨架

**Epic**: Epic 1 - 项目初始化与基础设施
**Story ID**: 1.1
**Story Title**: 创建 Go 项目骨架
**Status**: Draft
**估算工时**: 0.5 天 (4 小时)
**优先级**: P0 (MUST HAVE)
**创建日期**: 2025-10-02

---

## Story Statement

**作为** 后端开发者
**我想要** 初始化 Go 项目结构和依赖管理
**以便于** 为后续模块开发提供规范的项目骨架和开发环境

---

## Acceptance Criteria

### AC1: Go 项目编译成功
- [ ] `go build ./cmd/server` 成功编译
- [ ] 生成可执行文件 `siriusx-api`
- [ ] 无编译错误和警告

### AC2: 目录结构符合规范
- [ ] 目录结构符合 PRD 第 2.2 节定义
- [ ] 包含所有必需的顶层目录: `cmd/`, `internal/`, `web/`, `config/`, `docs/`
- [ ] 每个目录包含适当的 `.gitkeep` 或初始文件

### AC3: README 完整性
- [ ] README 包含项目愿景说明
- [ ] README 包含技术栈列表
- [ ] README 包含快速开始指南
- [ ] README 包含开发环境要求

### AC4: Git 仓库初始化
- [ ] Git 仓库成功初始化
- [ ] `.gitignore` 配置正确 (覆盖 Go、Node.js、IDE 文件)
- [ ] 首次提交包含项目骨架

---

## Dev Notes

### Previous Story Insights
- 无前序 Story (这是项目的第一个 Story)

### 技术栈信息

**后端技术栈** [Source: [architecture-design.md](../architecture-design.md#11-后端)]:
- **语言**: Go 1.21+
- **Web 框架**: Gin (轻量、高性能、中间件丰富)
- **数据库**: SQLite + GORM (类型安全、轻量级)
- **配置管理**: Viper (支持 YAML、环境变量)
- **日志**: Zap (结构化、高性能)
- **HTTP 客户端**: 标准库 `net/http` + 连接池

**前端技术栈** [Source: [architecture-design.md](../architecture-design.md#12-前端)]:
- **框架**: Astro 4.x (极致轻量、静态优先)
- **UI 组件**: React 组件、Tailwind CSS、Headless UI
- **状态管理**: Zustand (轻量级)
- **图表**: ECharts (监控面板)

**部署** [Source: [architecture-design.md](../architecture-design.md#13-部署)]:
- **容器化**: Docker + Docker Compose
- **基础镜像**: Alpine Linux
- **持久化**: Volume 挂载 (数据库 + 配置文件)

### 项目目录结构

[Source: [prd.md](../prd.md#22-项目结构)]

```
Siriusx-API/
├── cmd/
│   └── server/
│       └── main.go                # 主入口
├── internal/
│   ├── converter/                 # 格式转换引擎 (核心)
│   │   ├── claude_to_openai.go
│   │   ├── openai_to_claude.go
│   │   ├── stream_converter.go
│   │   └── types.go
│   ├── provider/                  # 供应商管理
│   ├── mapping/                   # 模型映射
│   ├── balancer/                  # 负载均衡
│   ├── token/                     # 令牌管理
│   └── api/                       # API 路由
├── web/                           # Astro 前端
│   ├── src/
│   │   ├── pages/
│   │   ├── components/
│   │   └── layouts/
│   └── astro.config.mjs
├── config/
│   ├── config.example.yaml
│   └── default_mappings.yaml
├── docs/
│   ├── prd.md                     # 本文档
│   ├── architecture-design.md     # 架构设计
│   └── format-conversion-study.md # 格式转换学习
├── Dockerfile
├── docker-compose.yml
├── go.mod
└── README.md
```

### Go Module 配置

**模块名称**: `github.com/moguw/Siriusx-API`

**核心依赖** [Source: [architecture-design.md](../architecture-design.md#11-后端)]:
```go
require (
    github.com/gin-gonic/gin v1.10.0
    gorm.io/gorm v1.25.5
    gorm.io/driver/sqlite v1.5.4
    github.com/spf13/viper v1.18.2
    go.uber.org/zap v1.26.0
)
```

### Makefile 命令规范

**必需命令**:
- `make build`: 编译项目 (`go build -o bin/siriusx-api ./cmd/server`)
- `make test`: 运行测试 (`go test ./...`)
- `make run`: 启动开发服务器 (`go run ./cmd/server`)
- `make clean`: 清理构建产物 (`rm -rf bin/`)
- `make lint`: 代码检查 (`golangci-lint run`)

### .gitignore 配置要求

**必须忽略的文件**:
- Go: `bin/`, `*.exe`, `*.test`, `*.out`, `vendor/`
- Node.js: `node_modules/`, `dist/`, `.astro/`
- IDE: `.vscode/`, `.idea/`, `*.swp`, `*.swo`
- 数据库: `*.db`, `*.sqlite`, `*.sqlite3`
- 配置: `config/config.yaml` (保留 `config.example.yaml`)
- 环境变量: `.env`, `.env.local`

### 编码规范

[Source: [architecture-design.md](../architecture-design.md#9-性能优化)]

- 遵循 Go 标准库风格指南
- 使用 `gofmt` 格式化代码
- 使用 `golangci-lint` 进行代码检查
- 错误处理使用显式 `if err != nil` 检查
- 包命名使用小写单数形式 (如 `provider` 而非 `providers`)
- 接口命名遵循 Go 惯例 (如 `Reader`, `Writer`, `Service`)

### 测试策略

[Source: [architecture-design.md](../architecture-design.md#11-测试策略)]

**测试目标**:
- 单元测试覆盖率 > 80%
- 集成测试覆盖关键流程
- E2E 测试覆盖主要用户场景

**测试工具**:
- Go 标准库 `testing`
- 断言库: `github.com/stretchr/testify/assert`
- Mock 工具: `github.com/stretchr/testify/mock`

### README 内容要求

[Source: [prd.md](../prd.md#11-核心愿景)]

**必需章节**:
1. **项目愿景**: 轻量级、可自托管的 AI 模型聚合网关
2. **核心特性**: 多供应商聚合、负载均衡、故障转移、Claude Code 支持
3. **技术栈**: Go 1.21+、Gin、SQLite、Astro、Docker
4. **快速开始**:
   - 环境要求 (Go 1.21+, Docker, Node.js 20+)
   - 安装依赖 (`go mod download`)
   - 启动服务 (`make run`)
5. **项目结构**: 简要说明目录布局
6. **文档链接**: PRD、架构设计、API 文档

### File Locations

[Source: [architecture-design.md](../architecture-design.md#2-目录结构)]

- **主入口文件**: `cmd/server/main.go`
- **Go 模块文件**: `go.mod`, `go.sum`
- **配置示例**: `config/config.example.yaml`
- **文档目录**: `docs/`
- **构建脚本**: `Makefile`
- **版本控制**: `.gitignore`
- **项目说明**: `README.md`

### Technical Constraints

- **Go 版本**: 必须使用 Go 1.21 或更高版本
- **模块路径**: 必须与实际 Git 仓库路径一致
- **目录结构**: 严格遵循 Go 标准项目布局 (cmd/, internal/, pkg/)
- **命名规范**: 遵循 Go 命名惯例 (包名小写、导出符号大写开头)

### Project Structure Notes

- 项目结构完全符合 Go 标准项目布局规范
- `internal/` 目录用于私有包,防止外部导入
- `cmd/` 目录用于可执行程序入口
- `web/` 目录用于前端代码 (Astro 项目)
- `config/` 目录用于配置文件模板
- `docs/` 目录用于项目文档

---

## Tasks / Subtasks

### Task 1: 初始化 Go Module (AC: 1)
- [ ] 1.1 运行 `go mod init github.com/moguw/Siriusx-API`
- [ ] 1.2 验证 `go.mod` 文件生成成功
- [ ] 1.3 设置 Go 版本为 1.21 (`go 1.21` 行)

### Task 2: 创建项目目录结构 (AC: 2)
- [ ] 2.1 创建顶层目录:
  - `cmd/server/`
  - `internal/converter/`
  - `internal/provider/`
  - `internal/mapping/`
  - `internal/balancer/`
  - `internal/token/`
  - `internal/api/handlers/`
  - `internal/api/middleware/`
  - `internal/config/`
  - `internal/models/`
  - `web/`
  - `config/`
  - `docs/stories/`
- [ ] 2.2 在空目录中创建 `.gitkeep` 文件
- [ ] 2.3 验证目录结构与 PRD 第 2.2 节一致

### Task 3: 创建基础 main.go (AC: 1)
- [ ] 3.1 在 `cmd/server/main.go` 创建基础入口文件
- [ ] 3.2 添加 package 声明和 main 函数
- [ ] 3.3 添加基础导入 (fmt)
- [ ] 3.4 添加版本信息和启动日志
- [ ] 3.5 测试编译: `go build ./cmd/server`

### Task 4: 配置 .gitignore (AC: 4)
- [ ] 4.1 创建 `.gitignore` 文件
- [ ] 4.2 添加 Go 忽略规则 (bin/, *.exe, vendor/)
- [ ] 4.3 添加 Node.js 忽略规则 (node_modules/, dist/)
- [ ] 4.4 添加 IDE 忽略规则 (.vscode/, .idea/)
- [ ] 4.5 添加数据库和配置文件忽略规则

### Task 5: 编写 README.md (AC: 3)
- [ ] 5.1 添加项目标题和徽章
- [ ] 5.2 编写项目愿景章节
- [ ] 5.3 列举核心特性 (多供应商、负载均衡、故障转移)
- [ ] 5.4 编写技术栈章节 (Go、Gin、SQLite、Astro)
- [ ] 5.5 编写快速开始章节 (环境要求、安装、启动)
- [ ] 5.6 添加项目结构简介
- [ ] 5.7 添加文档链接 (PRD、架构设计)

### Task 6: 创建 Makefile (AC: 1)
- [ ] 6.1 创建 `Makefile` 文件
- [ ] 6.2 添加 `build` 命令 (编译到 bin/ 目录)
- [ ] 6.3 添加 `test` 命令 (运行所有测试)
- [ ] 6.4 添加 `run` 命令 (启动开发服务器)
- [ ] 6.5 添加 `clean` 命令 (清理构建产物)
- [ ] 6.6 添加 `lint` 命令 (代码检查,可选)
- [ ] 6.7 添加 `help` 命令 (显示所有可用命令)
- [ ] 6.8 测试 `make build` 和 `make run`

### Task 7: Git 仓库初始化 (AC: 4)
- [ ] 7.1 运行 `git init` (如果尚未初始化)
- [ ] 7.2 添加所有文件: `git add .`
- [ ] 7.3 创建首次提交: `git commit -m "feat: initialize Go project skeleton"`
- [ ] 7.4 验证提交历史: `git log`

### Task 8: 创建配置文件模板
- [ ] 8.1 在 `config/` 创建 `config.example.yaml`
- [ ] 8.2 添加基础配置结构 (server, database, logging)
- [ ] 8.3 添加配置注释说明

### Task 9: 验证项目骨架完整性 (All ACs)
- [ ] 9.1 运行 `go build ./cmd/server` 验证编译成功
- [ ] 9.2 检查所有必需目录存在
- [ ] 9.3 检查 README 内容完整性
- [ ] 9.4 检查 Git 仓库状态
- [ ] 9.5 运行 `make help` 验证 Makefile 正常

---

## Testing Notes

### 手动测试清单
1. **编译测试**:
   ```bash
   go build ./cmd/server
   ./siriusx-api  # 应该输出启动信息
   ```

2. **Makefile 测试**:
   ```bash
   make build    # 应该生成 bin/siriusx-api
   make run      # 应该启动服务
   make clean    # 应该删除 bin/
   ```

3. **Git 测试**:
   ```bash
   git status    # 应该显示 clean working tree
   git log       # 应该显示首次提交
   ```

4. **目录结构验证**:
   ```bash
   tree -L 3     # 验证目录结构符合规范
   ```

### 验收测试步骤
1. 克隆项目到全新环境
2. 运行 `go mod download`
3. 运行 `make build`
4. 验证所有 AC 标准

---

## Definition of Done

- [ ] 所有 Acceptance Criteria 通过
- [ ] 所有 Tasks/Subtasks 完成
- [ ] 代码通过 `gofmt` 格式化
- [ ] README 完整且准确
- [ ] Git 提交历史清晰
- [ ] 项目可以在全新环境中成功编译和运行

---

## References

- [PRD - Epic 1 Story 1.1](../prd.md#story-11-创建-go-项目骨架)
- [Architecture Design - 项目结构](../architecture-design.md#2-目录结构)
- [Architecture Design - 技术栈](../architecture-design.md#1-技术栈)

---

## Dev Agent Record

### Implementation Notes
*(此部分由开发者在实现过程中填写)*

### Completion Notes
*(此部分由开发者在完成后填写)*

### Debug Log References
*(此部分记录调试日志引用)*

---

**Story 状态**: Draft
**下一步**: 等待 Product Owner 审核并批准,然后开始实现
