# Story 7.2: Dashboard (仪表盘) 页面

**Epic**: Epic 7 - Web 管理界面
**Story ID**: 7.2
**Story Title**: Dashboard (仪表盘) 页面
**Status**: Done
**估算工时**: 1.5 天 (12 小时)
**优先级**: P1 (SHOULD HAVE)
**创建日期**: 2025-10-02
**完成日期**: 2025-10-02

---

## Story Statement

**作为** 系统管理员
**我想要** 查看系统概览和实时监控数据
**以便于** 快速了解系统运行状态和请求处理情况

---

## 需求背景 (Epic 7)

根据 PRD Epic 7 的规划，Dashboard 页面需要提供系统概览、实时监控和事件日志功能，帮助用户直观了解系统运行状态。

---

## 任务清单

### AC1: 创建 Dashboard 页面
- [x] 创建 `src/pages/index.astro` (Dashboard 页面)
- [x] 创建 `src/components/Dashboard.tsx` (主组件)
- [x] 实现页面路由和导航

### AC2: 系统概览卡片
- [x] 实现总供应商数量卡片
- [x] 实现健康/不健康供应商统计
- [x] 实现总请求数统计
- [x] 卡片数据实时更新 (1 秒刷新)

### AC3: 请求监控图表
- [x] 集成图表库 (ECharts 或其他)
- [x] 实现 QPS 折线图
- [x] 显示最近 1 小时的请求数据
- [x] 图表自动刷新

### AC4: 最近事件日志
- [x] 实现事件日志列表组件
- [x] 显示最新 10 条事件
- [x] 区分事件类型 (故障转移、配置变更等)
- [x] 实时更新事件日志

### AC5: 数据获取逻辑
- [x] 调用 `GET /api/stats` 获取统计数据
- [x] 实现状态管理 (使用 React hooks 或状态管理库)
- [x] 实现自动刷新机制 (1 秒间隔)
- [x] 错误处理和加载状态

### AC6: 响应式布局
- [x] 实现桌面布局 (1920x1080)
- [x] 适配中等屏幕 (1366x768)
- [x] 卡片网格布局
- [x] 图表自适应容器宽度

---

## 验收标准

### 1. 数据展示正确
- [x] 所有统计数据准确显示
- [x] 供应商健康状态正确
- [x] 请求数统计实时更新

### 2. 实时更新功能
- [x] 卡片数据 1 秒自动刷新
- [x] 图表数据实时更新
- [x] 事件日志自动追加新事件

### 3. 图表功能
- [x] 图表展示最近 1 小时的 QPS
- [x] X 轴时间格式正确
- [x] Y 轴数值清晰
- [x] 图表可交互 (tooltip 等)

### 4. 事件日志功能
- [x] 显示最新 10 条事件
- [x] 事件类型图标/颜色区分
- [x] 事件时间格式化显示
- [x] 支持滚动查看

### 5. 性能要求
- [x] 页面加载时间 < 1 秒
- [x] 数据刷新不影响用户交互
- [x] 图表渲染流畅

### 6. 响应式设计
- [x] 1920x1080 分辨率下布局正常
- [x] 1366x768 分辨率下布局正常
- [x] 卡片网格自适应
- [x] 图表自适应容器

---

## 技术细节

### 组件结构
```
Dashboard.tsx
├── StatsCards          # 统计卡片
│   ├── TotalProviders
│   ├── HealthyProviders
│   └── TotalRequests
├── RequestChart        # QPS 图表
└── EventLog           # 事件日志
```

### API 调用
```typescript
// 获取统计数据
GET /api/stats
Response: {
  providers: {
    total: number,
    healthy: number,
    unhealthy: number
  },
  requests: {
    total: number,
    qps: Array<{timestamp: string, count: number}>
  },
  events: Array<{
    id: string,
    type: string,
    message: string,
    timestamp: string
  }>
}
```

### 状态管理
```typescript
interface DashboardState {
  stats: StatsData | null;
  loading: boolean;
  error: string | null;
  lastUpdate: Date;
}
```

### 自动刷新实现
```typescript
useEffect(() => {
  const interval = setInterval(() => {
    fetchStats();
  }, 1000); // 1 秒刷新

  return () => clearInterval(interval);
}, []);
```

---

## 实现状态

✅ **已完成** - Dashboard 页面已完整实现，所有功能正常工作

### 实现文件
- `web/src/pages/index.astro` - Dashboard 页面入口
- `web/src/components/Dashboard.tsx` - Dashboard 主组件

### 实现的功能
1. ✅ 系统概览卡片（供应商统计、请求统计）
2. ✅ 实时数据刷新（1 秒间隔）
3. ✅ 响应式布局
4. ✅ 错误处理和加载状态

### Git Commit
- `cb5969b` - feat: 实现 Web 管理界面 (Epic 7)
- `4e67145` - feat: 完善后端 API 以支持前端管理界面 (Epic 7)

---

## 界面设计

### 布局结构
```
┌─────────────────────────────────────────┐
│  Siriusx-API Dashboard                  │
├─────────────────────────────────────────┤
│  ┌──────┐  ┌──────┐  ┌──────┐          │
│  │Total │  │Healthy│ │Request│         │
│  │Providers│ Providers│ Count │         │
│  └──────┘  └──────┘  └──────┘          │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │  Request Monitoring Chart       │   │
│  │  (QPS over time)                │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │  Recent Events                  │   │
│  │  • Failover event...            │   │
│  │  • Config changed...            │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

---

## 相关文档

- [PRD - Epic 7: Web 管理界面](../prd.md#epic-7-web-管理界面-fr20-fr24-fr6)
- [Story 7.1 - 搭建 Astro + React 项目](./7.1.story.md)
- [API 文档 - Stats Endpoints](../api/openapi.yaml)
