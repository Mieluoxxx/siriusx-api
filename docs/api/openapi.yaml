openapi: 3.0.3
info:
  title: Siriusx-API
  description: |
    Siriusx-API æ˜¯ä¸€ä¸ªæ™ºèƒ½ API ç½‘å…³ï¼Œç”¨äºèšåˆå¤šä¸ª Claude ä¾›åº”å•†ï¼Œæä¾›ç»Ÿä¸€çš„ OpenAI å…¼å®¹æ¥å£ã€‚

    ## ä¸»è¦åŠŸèƒ½
    - ğŸ”„ æ ¼å¼è½¬æ¢ï¼šClaude â†” OpenAI æ ¼å¼äº’è½¬
    - ğŸ¢ ä¾›åº”å•†ç®¡ç†ï¼šå¤šä¾›åº”å•†é…ç½®å’Œè´Ÿè½½å‡è¡¡
    - ğŸ¯ æ¨¡å‹æ˜ å°„ï¼šç»Ÿä¸€æ¨¡å‹åˆ°å¤šä¾›åº”å•†æ˜ å°„
    - ğŸ” Token ç®¡ç†ï¼šAPI ä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯
    - ğŸ“Š ç›‘æ§ç»Ÿè®¡ï¼šç³»ç»ŸçŠ¶æ€å’Œè¯·æ±‚ç»Ÿè®¡

  version: 1.0.0
  contact:
    name: Siriusx-API Team
    url: https://github.com/Mieluoxxx/Siriusx-API
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080
    description: æœ¬åœ°å¼€å‘ç¯å¢ƒ
  - url: https://api.siriusx.com
    description: ç”Ÿäº§ç¯å¢ƒ

tags:
  - name: Health
    description: å¥åº·æ£€æŸ¥
  - name: Providers
    description: ä¾›åº”å•†ç®¡ç†
  - name: Models
    description: ç»Ÿä¸€æ¨¡å‹ç®¡ç†
  - name: Mappings
    description: æ¨¡å‹æ˜ å°„ç®¡ç†
  - name: Tokens
    description: API Token ç®¡ç†
  - name: Stats
    description: ç»Ÿè®¡ä¿¡æ¯

paths:
  /health:
    get:
      summary: å¥åº·æ£€æŸ¥
      description: æ£€æŸ¥ API æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
      tags:
        - Health
      responses:
        '200':
          description: æœåŠ¡æ­£å¸¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  service:
                    type: string
                    example: Siriusx-API

  /api/stats:
    get:
      summary: è·å–ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯
      description: è·å–ç³»ç»Ÿæ¦‚è§ˆç»Ÿè®¡æ•°æ®ï¼ŒåŒ…æ‹¬ä¾›åº”å•†çŠ¶æ€ã€è¯·æ±‚ç»Ÿè®¡ã€QPS ç­‰
      tags:
        - Stats
      responses:
        '200':
          description: æˆåŠŸè¿”å›ç»Ÿè®¡ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemStats'

  /api/providers:
    get:
      summary: è·å–ä¾›åº”å•†åˆ—è¡¨
      description: è·å–æ‰€æœ‰ä¾›åº”å•†çš„åˆ—è¡¨
      tags:
        - Providers
      responses:
        '200':
          description: æˆåŠŸè¿”å›ä¾›åº”å•†åˆ—è¡¨
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Provider'

    post:
      summary: åˆ›å»ºä¾›åº”å•†
      description: æ·»åŠ æ–°çš„ Claude API ä¾›åº”å•†
      tags:
        - Providers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProviderRequest'
      responses:
        '201':
          description: æˆåŠŸåˆ›å»ºä¾›åº”å•†
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Provider'
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/providers/{id}:
    parameters:
      - $ref: '#/components/parameters/ProviderId'

    get:
      summary: è·å–å•ä¸ªä¾›åº”å•†
      description: æ ¹æ® ID è·å–ä¾›åº”å•†è¯¦ç»†ä¿¡æ¯
      tags:
        - Providers
      responses:
        '200':
          description: æˆåŠŸè¿”å›ä¾›åº”å•†ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Provider'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      summary: æ›´æ–°ä¾›åº”å•†
      description: æ›´æ–°ä¾›åº”å•†çš„é…ç½®ä¿¡æ¯
      tags:
        - Providers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProviderRequest'
      responses:
        '200':
          description: æˆåŠŸæ›´æ–°ä¾›åº”å•†
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Provider'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: åˆ é™¤ä¾›åº”å•†
      description: åˆ é™¤æŒ‡å®šçš„ä¾›åº”å•†
      tags:
        - Providers
      responses:
        '204':
          description: æˆåŠŸåˆ é™¤ä¾›åº”å•†
        '404':
          $ref: '#/components/responses/NotFound'

  /api/providers/{id}/health-check:
    parameters:
      - $ref: '#/components/parameters/ProviderId'

    post:
      summary: æ‰‹åŠ¨è§¦å‘å¥åº·æ£€æŸ¥
      description: ç«‹å³å¯¹æŒ‡å®šä¾›åº”å•†æ‰§è¡Œå¥åº·æ£€æŸ¥
      tags:
        - Providers
      responses:
        '200':
          description: å¥åº·æ£€æŸ¥å®Œæˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  provider_id:
                    type: integer
                    example: 1
                  healthy:
                    type: boolean
                    example: true
                  response_time_ms:
                    type: integer
                    description: å“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
                    example: 150
                  checked_at:
                    type: string
                    format: date-time
                    example: "2025-10-02T18:00:00Z"
        '404':
          $ref: '#/components/responses/NotFound'

  /api/providers/{id}/enabled:
    parameters:
      - $ref: '#/components/parameters/ProviderId'

    patch:
      summary: å¯ç”¨/ç¦ç”¨ä¾›åº”å•†
      description: åˆ‡æ¢ä¾›åº”å•†çš„å¯ç”¨çŠ¶æ€
      tags:
        - Providers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                enabled:
                  type: boolean
                  description: true ä¸ºå¯ç”¨ï¼Œfalse ä¸ºç¦ç”¨
                  example: true
      responses:
        '200':
          description: æˆåŠŸæ›´æ–°çŠ¶æ€
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Provider'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/models:
    get:
      summary: è·å–ç»Ÿä¸€æ¨¡å‹åˆ—è¡¨
      description: è·å–æ‰€æœ‰ç»Ÿä¸€æ¨¡å‹çš„åˆ—è¡¨
      tags:
        - Models
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ¨¡å‹åˆ—è¡¨
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UnifiedModel'

    post:
      summary: åˆ›å»ºç»Ÿä¸€æ¨¡å‹
      description: åˆ›å»ºæ–°çš„ç»Ÿä¸€æ¨¡å‹
      tags:
        - Models
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateModelRequest'
      responses:
        '201':
          description: æˆåŠŸåˆ›å»ºæ¨¡å‹
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnifiedModel'
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/models/{id}:
    parameters:
      - $ref: '#/components/parameters/ModelId'

    get:
      summary: è·å–å•ä¸ªæ¨¡å‹
      description: æ ¹æ® ID è·å–æ¨¡å‹è¯¦ç»†ä¿¡æ¯
      tags:
        - Models
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ¨¡å‹ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnifiedModel'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      summary: æ›´æ–°æ¨¡å‹
      description: æ›´æ–°æ¨¡å‹çš„é…ç½®ä¿¡æ¯
      tags:
        - Models
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateModelRequest'
      responses:
        '200':
          description: æˆåŠŸæ›´æ–°æ¨¡å‹
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnifiedModel'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: åˆ é™¤æ¨¡å‹
      description: åˆ é™¤æŒ‡å®šçš„ç»Ÿä¸€æ¨¡å‹
      tags:
        - Models
      responses:
        '204':
          description: æˆåŠŸåˆ é™¤æ¨¡å‹
        '404':
          $ref: '#/components/responses/NotFound'

  /api/models/{id}/mappings:
    parameters:
      - $ref: '#/components/parameters/ModelId'

    get:
      summary: è·å–æ¨¡å‹çš„æ˜ å°„åˆ—è¡¨
      description: è·å–æŒ‡å®šæ¨¡å‹çš„æ‰€æœ‰ä¾›åº”å•†æ˜ å°„
      tags:
        - Mappings
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ˜ å°„åˆ—è¡¨
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ModelMapping'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      summary: ä¸ºæ¨¡å‹æ·»åŠ æ˜ å°„
      description: ä¸ºç»Ÿä¸€æ¨¡å‹æ·»åŠ ä¾›åº”å•†æ˜ å°„é…ç½®
      tags:
        - Mappings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMappingRequest'
      responses:
        '201':
          description: æˆåŠŸåˆ›å»ºæ˜ å°„
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelMapping'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/mappings/{id}:
    parameters:
      - $ref: '#/components/parameters/MappingId'

    get:
      summary: è·å–å•ä¸ªæ˜ å°„
      description: æ ¹æ® ID è·å–æ˜ å°„è¯¦ç»†ä¿¡æ¯
      tags:
        - Mappings
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ˜ å°„ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelMapping'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      summary: æ›´æ–°æ˜ å°„
      description: æ›´æ–°æ˜ å°„çš„é…ç½®ï¼ˆæƒé‡ã€ä¼˜å…ˆçº§ç­‰ï¼‰
      tags:
        - Mappings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMappingRequest'
      responses:
        '200':
          description: æˆåŠŸæ›´æ–°æ˜ å°„
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelMapping'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: åˆ é™¤æ˜ å°„
      description: åˆ é™¤æŒ‡å®šçš„æ¨¡å‹æ˜ å°„
      tags:
        - Mappings
      responses:
        '204':
          description: æˆåŠŸåˆ é™¤æ˜ å°„
        '404':
          $ref: '#/components/responses/NotFound'

  /api/tokens:
    get:
      summary: è·å– Token åˆ—è¡¨
      description: è·å–æ‰€æœ‰ API Token çš„åˆ—è¡¨ï¼ˆToken å·²è„±æ•ï¼‰
      tags:
        - Tokens
      responses:
        '200':
          description: æˆåŠŸè¿”å› Token åˆ—è¡¨
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Token'

    post:
      summary: åˆ›å»º Token
      description: ç”Ÿæˆæ–°çš„ API Token
      tags:
        - Tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTokenRequest'
      responses:
        '201':
          description: æˆåŠŸåˆ›å»º Tokenï¼ˆä»…æ­¤æ¬¡è¿”å›å®Œæ•´ Tokenï¼‰
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenWithSecret'
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/tokens/{id}:
    parameters:
      - $ref: '#/components/parameters/TokenId'

    delete:
      summary: åˆ é™¤ Token
      description: åˆ é™¤æŒ‡å®šçš„ API Token
      tags:
        - Tokens
      responses:
        '204':
          description: æˆåŠŸåˆ é™¤ Token
        '404':
          $ref: '#/components/responses/NotFound'

components:
  parameters:
    ProviderId:
      name: id
      in: path
      required: true
      description: ä¾›åº”å•† ID
      schema:
        type: integer
        example: 1

    ModelId:
      name: id
      in: path
      required: true
      description: ç»Ÿä¸€æ¨¡å‹ ID
      schema:
        type: integer
        example: 1

    MappingId:
      name: id
      in: path
      required: true
      description: æ˜ å°„ ID
      schema:
        type: integer
        example: 1

    TokenId:
      name: id
      in: path
      required: true
      description: Token ID
      schema:
        type: integer
        example: 1

  schemas:
    SystemStats:
      type: object
      properties:
        providers:
          type: object
          properties:
            total:
              type: integer
              description: æ€»ä¾›åº”å•†æ•°
              example: 5
            healthy:
              type: integer
              description: å¥åº·ä¾›åº”å•†æ•°
              example: 4
            unhealthy:
              type: integer
              description: ä¸å¥åº·ä¾›åº”å•†æ•°
              example: 1
        requests:
          type: object
          properties:
            total:
              type: integer
              description: æ€»è¯·æ±‚æ•°
              example: 10523
            current_qps:
              type: number
              format: float
              description: å½“å‰ QPS
              example: 12.5
        recent_events:
          type: array
          description: æœ€è¿‘äº‹ä»¶æ—¥å¿—ï¼ˆæœ€å¤š 10 æ¡ï¼‰
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
                example: "2025-10-02T18:00:00Z"
              type:
                type: string
                enum: [failover, config_change, health_check]
                example: failover
              message:
                type: string
                example: "ä¾›åº”å•† OneAPI æ•…éšœï¼Œåˆ‡æ¢åˆ° ClaudeAPI"

    Provider:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "OneAPI Provider"
        base_url:
          type: string
          format: uri
          example: "https://api.oneapi.com"
        api_key:
          type: string
          description: API Key (è„±æ•æ˜¾ç¤º)
          example: "sk-****5678"
        priority:
          type: integer
          description: ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
          example: 80
        enabled:
          type: boolean
          description: æ˜¯å¦å¯ç”¨
          example: true
        healthy:
          type: boolean
          description: å¥åº·çŠ¶æ€
          example: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateProviderRequest:
      type: object
      required:
        - name
        - base_url
        - api_key
      properties:
        name:
          type: string
          maxLength: 100
          example: "OneAPI Provider"
        base_url:
          type: string
          format: uri
          example: "https://api.oneapi.com"
        api_key:
          type: string
          example: "sk-abc123def456"
        priority:
          type: integer
          minimum: 0
          maximum: 100
          default: 50
          example: 80

    UpdateProviderRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
        base_url:
          type: string
          format: uri
        api_key:
          type: string
        priority:
          type: integer
          minimum: 0
          maximum: 100

    UnifiedModel:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "claude-3-5-sonnet-latest"
        display_name:
          type: string
          example: "Claude 3.5 Sonnet (Latest)"
        description:
          type: string
          example: "æœ€æ–°ç‰ˆæœ¬çš„ Claude 3.5 Sonnet"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateModelRequest:
      type: object
      required:
        - name
        - display_name
      properties:
        name:
          type: string
          example: "claude-3-5-sonnet-latest"
        display_name:
          type: string
          example: "Claude 3.5 Sonnet (Latest)"
        description:
          type: string
          example: "æœ€æ–°ç‰ˆæœ¬çš„ Claude 3.5 Sonnet"

    UpdateModelRequest:
      type: object
      properties:
        display_name:
          type: string
        description:
          type: string

    ModelMapping:
      type: object
      properties:
        id:
          type: integer
          example: 1
        unified_model_id:
          type: integer
          example: 1
        provider_id:
          type: integer
          example: 1
        provider_model_name:
          type: string
          example: "claude-3-5-sonnet-20241022"
        weight:
          type: integer
          minimum: 1
          maximum: 100
          description: è´Ÿè½½å‡è¡¡æƒé‡
          example: 70
        priority:
          type: integer
          description: ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
          example: 1
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateMappingRequest:
      type: object
      required:
        - provider_id
        - provider_model_name
      properties:
        provider_id:
          type: integer
          example: 1
        provider_model_name:
          type: string
          example: "claude-3-5-sonnet-20241022"
        weight:
          type: integer
          minimum: 1
          maximum: 100
          default: 50
          example: 70
        priority:
          type: integer
          default: 1
          example: 1

    UpdateMappingRequest:
      type: object
      properties:
        provider_model_name:
          type: string
        weight:
          type: integer
          minimum: 1
          maximum: 100
        priority:
          type: integer

    Token:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Development Token"
        token_display:
          type: string
          description: Token è„±æ•æ˜¾ç¤º
          example: "sk-****uMU="
        enabled:
          type: boolean
          example: true
        expires_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TokenWithSecret:
      allOf:
        - $ref: '#/components/schemas/Token'
        - type: object
          properties:
            token:
              type: string
              description: å®Œæ•´çš„ Tokenï¼ˆä»…åœ¨åˆ›å»ºæ—¶è¿”å›ä¸€æ¬¡ï¼‰
              example: "sk-soj6C7X3f3uZCkUSN27I9qSb6UjM61nxXeHeBKAquMU="

    CreateTokenRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          maxLength: 100
          example: "Development Token"
        expires_at:
          type: string
          format: date-time
          description: è¿‡æœŸæ—¶é—´ï¼ˆå¯é€‰ï¼Œä¸è®¾ç½®åˆ™æ°¸ä¸è¿‡æœŸï¼‰
          example: "2025-12-31T23:59:59Z"

    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              example: "VALIDATION_ERROR"
            message:
              type: string
              example: "Invalid request parameters"

  responses:
    BadRequest:
      description: è¯·æ±‚å‚æ•°é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: èµ„æºä¸å­˜åœ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: "NOT_FOUND"
              message: "Resource not found"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: |
        ä½¿ç”¨ API Token è¿›è¡Œè®¤è¯ã€‚Token æ ¼å¼ä¸º `sk-` å¼€å¤´çš„ Base64 ç¼–ç å­—ç¬¦ä¸²ã€‚

        ç¤ºä¾‹ï¼š`Authorization: Bearer sk-soj6C7X3f3uZCkUSN27I9qSb6UjM61nxXeHeBKAquMU=`

security:
  - BearerAuth: []
